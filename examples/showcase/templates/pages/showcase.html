{#- Complex Feature Showcase Template -#}
{#- Demonstrates: inheritance, imports, advanced loops, filters, tests, and more -#}

{% extends "layouts/base.html" %}
{% from "components/macros.html" import button, card, user_badge, data_table, alert, render_list, format_number, code_block %}

{#- Override title block -#}
{% block title %}Miya Feature Showcase - {{ super() }}{% endblock %}

{#- Custom styles for this page -#}
{% block custom_styles %}
.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin: 20px 0;
}
.code-example {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 15px;
    border-radius: 5px;
    overflow-x: auto;
}
.badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 3px;
    font-size: 0.85em;
    margin: 2px;
}
{% endblock %}

{#- Main content -#}
{% block content %}

{#- Section 1: Variables and Filters -#}
<section>
    <h2>1. Variables and Filters</h2>

    {#- Simple variable substitution -#}
    <p>Hello, {{ username|default('Guest')|title }}!</p>

    {#- Filter chaining -#}
    {% set long_text = "  this is a very long text that needs to be processed with multiple filters  " %}
    <p>Processed: {{ long_text|trim|title|truncate(30) }}</p>

    {#- String filters -#}
    <div class="feature-grid">
        {{ card("Upper Case", "hello world"|upper) }}
        {{ card("Lower Case", "HELLO WORLD"|lower) }}
        {{ card("Capitalize", "hello world"|capitalize) }}
        {{ card("Title Case", "hello world"|title) }}
    </div>
</section>

{#- Section 2: Control Structures -#}
<section>
    <h2>2. Control Structures</h2>

    {#- If/elif/else conditions -#}
    {% set user_role = role|default('guest') %}
    {% if user_role == 'admin' %}
        {{ alert("You have full administrator access", "success", true, "üîë") }}
    {% elif user_role == 'moderator' %}
        {{ alert("You have moderator privileges", "info", true, "üëÆ") }}
    {% elif user_role == 'user' %}
        {{ alert("You have standard user access", "info", true, "üë§") }}
    {% else %}
        {{ alert("You are browsing as a guest", "warning", true, "üëÅÔ∏è") }}
    {% endif %}

    {#- Ternary operator -#}
    <p>Status: {{ 'Active' if is_active else 'Inactive' }}</p>
</section>

{#- Section 3: Loops and Iteration -#}
<section>
    <h2>3. Loops and Iteration</h2>

    {#- Basic for loop with loop variables -#}
    <h3>Loop Variables Demo</h3>
    {% set colors = ['red', 'green', 'blue', 'yellow', 'purple'] %}
    <ul>
    {% for color in colors %}
        <li>
            <span class="badge" style="background: {{ color }}; color: white;">
                #{{ loop.index }} - {{ color|title }}
                {%- if loop.first %} (First){% endif -%}
                {%- if loop.last %} (Last){% endif -%}
            </span>
            - Index0: {{ loop.index0 }}, RevIndex: {{ loop.revindex }}
        </li>
    {% endfor %}
    </ul>

    {#- Conditional iteration -#}
    <h3>Conditional Iteration (Even Numbers Only)</h3>
    {% set numbers = range(1, 11) %}
    <ul class="number-list">
    {% for num in numbers if num is even %}
        <li>{{ num }}</li>
    {% endfor %}
    </ul>

    {#- Loop cycle -#}
    <h3>Loop Cycle</h3>
    <table>
    {% for i in range(5) %}
        <tr class="{{ loop.cycle('odd', 'even') }}">
            <td>Row {{ loop.index }}</td>
            <td>Class: {{ loop.cycle('odd', 'even') }}</td>
        </tr>
    {% endfor %}
    </table>

    {#- Nested loops with loop depth -#}
    <h3>Nested Loops</h3>
    {% for i in range(1, 4) %}
        <div>Outer {{ i }} (depth: {{ loop.depth }})
            {% for j in range(1, 3) %}
                <span>Inner {{ i }}.{{ j }} (depth: {{ loop.depth }})</span>
            {% endfor %}
        </div>
    {% endfor %}

    {#- Dictionary iteration -#}
    <h3>Dictionary Iteration</h3>
    {% set user_info = {'name': 'Alice', 'age': 30, 'city': 'New York'} %}
    <dl>
    {% for key, value in user_info.items() %}
        <dt>{{ key|title }}</dt>
        <dd>{{ value }}</dd>
    {% endfor %}
    </dl>
</section>

{#- Section 4: Tests and Conditionals -#}
<section>
    <h2>4. Tests and Conditionals</h2>

    {% set test_values = [42, 'hello', none, [1, 2, 3], true, '', 0] %}
    <table class="table">
        <thead>
            <tr>
                <th>Value</th>
                <th>Type Tests</th>
                <th>State Tests</th>
            </tr>
        </thead>
        <tbody>
        {% for val in test_values %}
            <tr>
                <td><code>{{ val }}</code></td>
                <td>
                    {% if val is string %}String{% endif %}
                    {% if val is number %}Number{% endif %}
                    {% if val is boolean %}Boolean{% endif %}
                    {% if val is iterable %}Iterable{% endif %}
                    {% if val is mapping %}Mapping{% endif %}
                </td>
                <td>
                    {% if val is defined %}Defined{% endif %}
                    {% if val is none %}None{% endif %}
                    {% if val is number %}
                        {% if val is even %}Even{% endif %}
                        {% if val is odd %}Odd{% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</section>

{#- Section 5: Advanced Filter Features -#}
<section>
    <h2>5. Advanced Filters</h2>

    {#- Numeric filters -#}
    <h3>Numeric Filters</h3>
    {% set pi = 3.14159265359 %}
    <ul>
        <li>Original: {{ pi }}</li>
        <li>Rounded (2): {{ pi|round(2) }}</li>
        <li>Absolute: {{ -42|abs }}</li>
        <li>As Integer: {{ pi|int }}</li>
    </ul>

    {#- Collection filters -#}
    <h3>Collection Filters</h3>
    {% set items = [5, 2, 8, 1, 9, 3] %}
    <ul>
        <li>Original: {{ items|join(', ') }}</li>
        <li>Sorted: {{ items|sort|join(', ') }}</li>
        <li>Reversed: {{ items|reverse|join(', ') }}</li>
        <li>First: {{ items|first }}</li>
        <li>Last: {{ items|last }}</li>
        <li>Length: {{ items|length }}</li>
    </ul>

    {#- Filter blocks -#}
    <h3>Filter Blocks</h3>
    {% filter upper %}
        This entire block will be uppercased.
        It can span multiple lines.
        {% for i in range(3) %}
        Line {{ i + 1 }}
        {% endfor %}
    {% endfilter %}

    {#- HTML/Safety filters -#}
    <h3>HTML Escaping</h3>
    {% set html_content = "<script>alert('xss')</script>" %}
    <p>Escaped: {{ html_content }}</p>
    <p>Safe (use carefully): {{ html_content|safe }}</p>
</section>

{#- Section 6: Assignments and Variables -#}
<section>
    <h2>6. Assignments and Variables</h2>

    {#- Simple assignment -#}
    {% set greeting = "Hello, World!" %}
    <p>{{ greeting }}</p>

    {#- Multiple assignment / Unpacking -#}
    {% set coordinates = [10, 20, 30] %}
    {% set x, y, z = coordinates %}
    <p>X={{ x }}, Y={{ y }}, Z={{ z }}</p>

    {#- Namespace for mutable state -#}
    <h3>Namespace Example</h3>
    {% set ns = namespace(total=0, count=0) %}
    {% for item in [10, 20, 30, 40, 50] %}
        {% set ns.total = ns.total + item %}
        {% set ns.count = ns.count + 1 %}
    {% endfor %}
    <p>Sum of {{ ns.count }} items: {{ ns.total }}</p>

    {#- Block assignment -#}
    {% set my_html %}
        <div class="custom">
            <h4>Block Assignment</h4>
            <p>This entire HTML block is assigned to a variable!</p>
        </div>
    {% endset %}
    {{ my_html }}
</section>

{#- Section 7: Macros Usage -#}
<section>
    <h2>7. Macros</h2>

    {#- Simple macro call -#}
    {{ button("Click Me", "/action") }}
    {{ button("Learn More", "/docs") }}

    {#- Macro with defaults -#}
    <div class="feature-grid">
        {{ card("Light Theme", "Default light card") }}
        {{ card("Dark Theme", "Custom dark card", theme='dark') }}
        {{ card("Wide Card", "This is wider", width='600px') }}
    </div>

    {#- Complex macro -#}
    {% set sample_user = {'name': 'john doe', 'email': 'john@example.com', 'status': 'online', 'avatar': '/img/john.jpg'} %}
    {{ user_badge(sample_user, show_email=true) }}
</section>

{#- Section 8: Data Tables -#}
<section>
    <h2>8. Data Tables</h2>

    {% set headers = ['Name', 'Age', 'City', 'Status'] %}
    {% set rows = [
        ['Alice Johnson', 28, 'New York', 'Active'],
        ['Bob Smith', 35, 'Los Angeles', 'Active'],
        ['Charlie Brown', 42, 'Chicago', 'Inactive'],
        ['Diana Prince', 31, 'Seattle', 'Active']
    ] %}

    {{ data_table(headers, rows, striped=true) }}
</section>

{#- Section 9: Global Functions -#}
<section>
    <h2>9. Global Functions</h2>

    {#- range() function -#}
    <h3>Range Function</h3>
    {{ render_list(range(5, 16, 2)) }}

    {#- zip() function -#}
    <h3>Zip Function</h3>
    {% set names = ['Alice', 'Bob', 'Charlie'] %}
    {% set ages = [25, 30, 35] %}
    <ul>
    {% for name, age in zip(names, ages) %}
        <li>{{ name }} is {{ age }} years old</li>
    {% endfor %}
    </ul>

    {#- enumerate() function -#}
    <h3>Enumerate Function</h3>
    {% set fruits = ['apple', 'banana', 'cherry'] %}
    <ul>
    {% for idx, fruit in enumerate(fruits) %}
        <li>{{ idx }}: {{ fruit|title }}</li>
    {% endfor %}
    </ul>

    {#- dict() function -#}
    {% set custom_dict = dict(a=1, b=2, c=3) %}
    <p>Dict: {{ custom_dict }}</p>
</section>

{#- Section 10: Slicing and Indexing -#}
<section>
    <h2>10. Slicing and Indexing</h2>

    {% set alphabet = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'] %}
    <ul>
        <li>First 3: {{ alphabet[:3]|join(', ') }}</li>
        <li>Last 3: {{ alphabet[-3:]|join(', ') }}</li>
        <li>Middle: {{ alphabet[2:5]|join(', ') }}</li>
        <li>Every other: {{ alphabet[::2]|join(', ') }}</li>
        <li>Reversed: {{ alphabet[::-1]|join(', ') }}</li>
    </ul>

    {#- String slicing -#}
    {% set word = "Hello, World!" %}
    <p>Substring: "{{ word[0:5] }}"</p>
</section>

{#- Section 11: Whitespace Control -#}
<section>
    <h2>11. Whitespace Control</h2>

    <pre>
{%- for i in range(3) %}
Line {{ i + 1 }}
{%- endfor %}
    </pre>

    <p>
        Tight spacing:
        {%- for item in ['A', 'B', 'C'] -%}
            {{ item }}
        {%- endfor -%}
        !
    </p>
</section>

{#- Section 12: Comments -#}
<section>
    <h2>12. Comments</h2>

    {# This is a comment and won't appear in output #}
    <p>Comments are hidden from the output.</p>
    {#
        Multi-line comments
        are also supported
        and very useful for documentation
    #}
</section>

{#- Section 13: Expressions and Operators -#}
<section>
    <h2>13. Expressions and Operators</h2>

    {#- Arithmetic -#}
    <h3>Arithmetic Operators</h3>
    <ul>
        <li>Addition: 5 + 3 = {{ 5 + 3 }}</li>
        <li>Subtraction: 10 - 4 = {{ 10 - 4 }}</li>
        <li>Multiplication: 6 * 7 = {{ 6 * 7 }}</li>
        <li>Division: 15 / 3 = {{ 15 / 3 }}</li>
        <li>Floor Division: 17 // 5 = {{ 17 // 5 }}</li>
        <li>Modulo: 17 % 5 = {{ 17 % 5 }}</li>
        <li>Power: 2 ** 8 = {{ 2 ** 8 }}</li>
    </ul>

    {#- Comparison -#}
    <h3>Comparison Operators</h3>
    <ul>
        <li>5 > 3: {{ 5 > 3 }}</li>
        <li>5 < 3: {{ 5 < 3 }}</li>
        <li>5 == 5: {{ 5 == 5 }}</li>
        <li>5 != 3: {{ 5 != 3 }}</li>
    </ul>

    {#- Logical -#}
    <h3>Logical Operators</h3>
    <ul>
        <li>true and false: {{ true and false }}</li>
        <li>true or false: {{ true or false }}</li>
        <li>not true: {{ not true }}</li>
    </ul>

    {#- String concatenation -#}
    <h3>String Concatenation</h3>
    <p>{{ "Hello" ~ " " ~ "World" }}</p>
</section>

{#- Section 14: Do Statements -#}
<section>
    <h2>14. Do Statements</h2>

    {% set items = [1, 2, 3] %}
    {% do items.append(4) %}
    <p>List after append: {{ items|join(', ') }}</p>
</section>

{#- Section 15: Advanced Features Summary -#}
<section>
    <h2>15. Summary</h2>

    {{ alert("This showcase demonstrates most of Miya's features!", "success", false) }}

    <div class="feature-grid">
        {{ card("Template Inheritance", "Base templates and block overrides ‚úì") }}
        {{ card("Macros", "Reusable components with parameters ‚úì") }}
        {{ card("Filters", "50+ built-in filters for data transformation ‚úì") }}
        {{ card("Control Flow", "If/else, for loops, while loops ‚úì") }}
        {{ card("Tests", "Type checking and state validation ‚úì") }}
        {{ card("Global Functions", "range, dict, zip, enumerate, etc. ‚úì") }}
    </div>
</section>

{% endblock %}

{#- Footer customization -#}
{% block footer_content %}
    <p>Generated with Miya - A high-performance Jinja2 engine in Go</p>
{% endblock %}
